{"mappings":"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","sources":["<anon>","src/js/main.js"],"sourcesContent":["document.addEventListener(\"DOMContentLoaded\", ()=>{\n    const API_BASE_URL = \"http://localhost:3000/api\";\n    const modal = document.getElementById(\"modal\");\n    const modalTitle = document.getElementById(\"modalTitle\");\n    const modalBody = document.getElementById(\"modalBody\");\n    const modalClose = document.getElementById(\"modalClose\");\n    const modalContent = document.querySelector(\".modal-content\");\n    const contentArea = document.getElementById(\"content-area\");\n    const themeToggle = document.getElementById(\"themeToggle\");\n    // --- THEME --- //\n    const savedTheme = localStorage.getItem(\"theme\");\n    if (savedTheme === \"dark\") document.body.classList.add(\"dark\");\n    themeToggle.addEventListener(\"click\", ()=>{\n        document.body.classList.toggle(\"dark\");\n        const isDark = document.body.classList.contains(\"dark\");\n        localStorage.setItem(\"theme\", isDark ? \"dark\" : \"light\");\n    });\n    // --- MODAL --- //\n    function showModal(title, bodyHtml) {\n        modalTitle.textContent = title;\n        modalBody.innerHTML = bodyHtml;\n        modal.classList.remove(\"hidden\");\n        modalContent.classList.add(\"start-animation\");\n    }\n    function hideModal() {\n        modalContent.classList.remove(\"start-animation\");\n        modal.classList.add(\"hidden\");\n    }\n    modalClose.addEventListener(\"click\", hideModal);\n    window.addEventListener(\"click\", (e)=>{\n        if (e.target === modal) hideModal();\n    });\n    // --- GLOBAL HELPERS --- //\n    function formatearFecha(fechaString, includeTime = false) {\n        if (!fechaString) return \"N/A\";\n        const fecha = new Date(fechaString);\n        const userTimezoneOffset = fecha.getTimezoneOffset() * 60000;\n        const adjustedDate = new Date(fecha.getTime() + userTimezoneOffset);\n        const options = {\n            day: \"2-digit\",\n            month: \"2-digit\",\n            year: \"numeric\"\n        };\n        if (includeTime) {\n            options.hour = \"2-digit\";\n            options.minute = \"2-digit\";\n        }\n        return adjustedDate.toLocaleString(\"es-ES\", options);\n    }\n    async function actualizarDashboard() {\n        try {\n            const [productosRes, movimientosRes] = await Promise.all([\n                fetch(`${API_BASE_URL}/productos`),\n                fetch(`${API_BASE_URL}/movimientos`)\n            ]);\n            if (!productosRes.ok || !movimientosRes.ok) throw new Error(\"Error al cargar datos del dashboard\");\n            const productos = await productosRes.json();\n            const movimientos = await movimientosRes.json();\n            // Update dashboard cards\n            const STOCK_CRITICO_UMBRAL = 10;\n            const DIAS_PARA_VENCER_UMBRAL = 30;\n            const hoy = new Date();\n            const stockCritico = productos.filter((p)=>p.cantidad < STOCK_CRITICO_UMBRAL).length;\n            const proximosAVencer = productos.filter((p)=>{\n                if (!p.vencimiento) return false;\n                const fechaVencimiento = new Date(p.vencimiento);\n                const diffTiempo = fechaVencimiento.getTime() - hoy.getTime();\n                const diffDias = Math.ceil(diffTiempo / 86400000);\n                return diffDias > 0 && diffDias <= DIAS_PARA_VENCER_UMBRAL;\n            }).length;\n            document.getElementById(\"totalProductos\").textContent = productos.length;\n            document.getElementById(\"stockCritico\").textContent = stockCritico;\n            document.getElementById(\"proximosAVencer\").textContent = proximosAVencer;\n            // Update movimientos\n            const contenedor = document.getElementById(\"ultimosMovimientos\");\n            if (!movimientos || movimientos.length === 0) {\n                contenedor.innerHTML = \"<p>No hay movimientos recientes.</p>\";\n                return;\n            }\n            const lista = document.createElement(\"ul\");\n            lista.className = \"movimientos-lista\";\n            movimientos.forEach((mov)=>{\n                const item = document.createElement(\"li\");\n                const tipoClase = mov.Tipo === \"Entrada\" ? \"entrada\" : \"salida\";\n                item.innerHTML = `\n              <span class=\"movimiento-tipo ${tipoClase}\">${mov.Tipo}</span>\n              <span class=\"movimiento-cantidad\">${mov.Cantidad} x</span>\n              <span class=\"movimiento-nombre\">${mov.ProductoNombre}</span>\n              <span class=\"movimiento-fecha\">${formatearFecha(mov.Fecha, true)}</span>\n          `;\n                lista.appendChild(item);\n            });\n            contenedor.innerHTML = \"\";\n            contenedor.appendChild(lista);\n        } catch (error) {\n            console.error(\"Error actualizando dashboard:\", error);\n        }\n    }\n    // --- DYNAMIC CONTENT LOADING --- //\n    function loadScript(src) {\n        return new Promise((resolve, reject)=>{\n            const script = document.createElement(\"script\");\n            script.src = src;\n            script.onload = resolve;\n            script.onerror = reject;\n            document.head.appendChild(script);\n        });\n    }\n    function loadContent(url, section) {\n        fetch(url).then((response)=>response.text()).then((data)=>{\n            contentArea.innerHTML = data;\n            document.getElementById(\"header-title\").textContent = section.charAt(0).toUpperCase() + section.slice(1);\n            switch(section){\n                case \"inventario\":\n                    activarInventario();\n                    break;\n                case \"usuarios\":\n                    activarUsuarios();\n                    break;\n                case \"entrada\":\n                    activarEntrada();\n                    break;\n                case \"salida\":\n                    activarSalida();\n                    break;\n                case \"reportes\":\n                    loadScript(\"https://cdn.jsdelivr.net/npm/chart.js\").then(()=>{\n                        activarReportes();\n                    }).catch((error)=>{\n                        console.error(\"Error loading Chart.js\", error);\n                        contentArea.innerHTML = \"<p>Error al cargar la librer\\xeda de gr\\xe1ficos.</p>\";\n                    });\n                    break;\n            }\n        }).catch((error)=>{\n            console.error(\"Error al cargar la secci\\xf3n:\", error);\n            contentArea.innerHTML = \"<p>Error al cargar la secci\\xf3n.</p>\";\n        });\n    }\n    // --- REPORTES LOGIC --- //\n    function activarReportes() {\n        const formReportes = document.getElementById(\"formReportes\");\n        const reporteContainer = document.getElementById(\"reporteContainer\");\n        const reporteHeader = document.getElementById(\"reporteHeader\");\n        const reporteTitulo = document.getElementById(\"reporteTitulo\");\n        const btnImprimir = document.getElementById(\"btnImprimir\");\n        const reporteContenido = document.getElementById(\"reporteContenido\");\n        const fechaInicioInput = document.getElementById(\"fechaInicioReporte\");\n        const fechaFinInput = document.getElementById(\"fechaFinReporte\");\n        const tipoReporteSelect = document.getElementById(\"tipoReporte\");\n        // Show/hide date fields based on report type\n        tipoReporteSelect.addEventListener(\"change\", ()=>{\n            const selected = tipoReporteSelect.value;\n            if (selected === \"entradas\" || selected === \"salidas\") {\n                fechaInicioInput.parentElement.style.display = \"block\";\n                fechaFinInput.parentElement.style.display = \"block\";\n            } else {\n                fechaInicioInput.parentElement.style.display = \"none\";\n                fechaFinInput.parentElement.style.display = \"none\";\n            }\n        });\n        // Trigger change on load\n        tipoReporteSelect.dispatchEvent(new Event(\"change\"));\n        btnImprimir.addEventListener(\"click\", ()=>{\n            window.print();\n        });\n        formReportes.addEventListener(\"submit\", async function(event) {\n            event.preventDefault();\n            const tipoReporte = tipoReporteSelect.value;\n            const fechaInicio = fechaInicioInput.value;\n            const fechaFin = fechaFinInput.value;\n            reporteContenido.innerHTML = \"<p>Generando reporte...</p>\";\n            reporteHeader.style.display = \"none\";\n            try {\n                let url;\n                let data;\n                switch(tipoReporte){\n                    case \"inventario\":\n                        url = `${API_BASE_URL}/productos`;\n                        const response = await fetch(url);\n                        if (!response.ok) throw new Error(\"Error al cargar el inventario.\");\n                        data = await response.json();\n                        renderizarReporteInventario(data);\n                        break;\n                    case \"entradas\":\n                    case \"salidas\":\n                        url = `${API_BASE_URL}/movimientos?tipo=${tipoReporte.slice(0, -1)}&inicio=${fechaInicio}&fin=${fechaFin}`;\n                        const movResponse = await fetch(url);\n                        if (!movResponse.ok) throw new Error(`Error al cargar ${tipoReporte}.`);\n                        data = await movResponse.json();\n                        renderizarReporteMovimientos(data, tipoReporte);\n                        break;\n                    case \"vencimientos\":\n                        url = `${API_BASE_URL}/productos/vencimiento`;\n                        const vencResponse = await fetch(url);\n                        if (!vencResponse.ok) throw new Error(\"Error al cargar productos por vencer.\");\n                        data = await vencResponse.json();\n                        renderizarReporteVencimientos(data);\n                        break;\n                }\n            } catch (error) {\n                reporteContenido.innerHTML = `<p class=\"error\">Error: ${error.message}</p>`;\n                console.error(\"Error al generar reporte:\", error);\n            }\n        });\n        function generarGrafico(data, tipoReporte) {\n            const ctx = document.getElementById(\"reporteGrafico\").getContext(\"2d\");\n            let chartData = {};\n            // Destroy previous chart instance if it exists\n            if (window.myChart instanceof Chart) window.myChart.destroy();\n            switch(tipoReporte){\n                case \"inventario\":\n                    chartData = {\n                        labels: data.map((p)=>p.nombre),\n                        datasets: [\n                            {\n                                label: \"Cantidad en Inventario\",\n                                data: data.map((p)=>p.cantidad),\n                                backgroundColor: \"rgba(54, 162, 235, 0.6)\",\n                                borderColor: \"rgba(54, 162, 235, 1)\",\n                                borderWidth: 1\n                            }\n                        ]\n                    };\n                    break;\n                case \"entradas\":\n                case \"salidas\":\n                    const dataAgrupada = data.reduce((acc, m)=>{\n                        const fecha = formatearFecha(m.Fecha);\n                        acc[fecha] = (acc[fecha] || 0) + m.Cantidad;\n                        return acc;\n                    }, {});\n                    chartData = {\n                        labels: Object.keys(dataAgrupada),\n                        datasets: [\n                            {\n                                label: `Cantidad de ${tipoReporte}`,\n                                data: Object.values(dataAgrupada),\n                                backgroundColor: tipoReporte === \"entradas\" ? \"rgba(75, 192, 192, 0.6)\" : \"rgba(255, 99, 132, 0.6)\",\n                                borderColor: tipoReporte === \"entradas\" ? \"rgba(75, 192, 192, 1)\" : \"rgba(255, 99, 132, 1)\",\n                                borderWidth: 1\n                            }\n                        ]\n                    };\n                    break;\n                case \"vencimientos\":\n                    chartData = {\n                        labels: data.map((p)=>p.nombre),\n                        datasets: [\n                            {\n                                label: \"D\\xedas para Vencer\",\n                                data: data.map((p)=>{\n                                    const hoy = new Date();\n                                    const fechaVencimiento = new Date(p.vencimiento);\n                                    const diffTiempo = fechaVencimiento.getTime() - hoy.getTime();\n                                    return Math.ceil(diffTiempo / 86400000);\n                                }),\n                                backgroundColor: \"rgba(255, 159, 64, 0.6)\",\n                                borderColor: \"rgba(255, 159, 64, 1)\",\n                                borderWidth: 1\n                            }\n                        ]\n                    };\n                    break;\n            }\n            window.myChart = new Chart(ctx, {\n                type: \"bar\",\n                data: chartData,\n                options: {\n                    scales: {\n                        y: {\n                            beginAtZero: true\n                        }\n                    },\n                    responsive: true,\n                    maintainAspectRatio: false\n                }\n            });\n        }\n        function renderizarReporteInventario(productos) {\n            reporteHeader.style.display = \"flex\";\n            reporteTitulo.textContent = \"Reporte de Inventario Actual\";\n            reporteContenido.innerHTML = '<div class=\"chart-container\"><canvas id=\"reporteGrafico\"></canvas></div><div id=\"tablaReporteContenedor\"></div>';\n            if (productos.length === 0) {\n                reporteContenido.innerHTML = \"<p>No hay productos en el inventario.</p>\";\n                return;\n            }\n            generarGrafico(productos, \"inventario\");\n            const tabla = `\n            <table class=\"tabla-reporte\">\n                <thead>\n                    <tr>\n                        <th>Nombre</th>\n                        <th>Categor\\xeda</th>\n                        <th>Cantidad</th>\n                        <th>Ubicaci\\xf3n</th>\n                        <th>Fecha Ingreso</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${productos.map((p)=>`\n                        <tr>\n                            <td>${p.nombre}</td>\n                            <td>${p.categoria}</td>\n                            <td>${p.cantidad}</td>\n                            <td>${p.ubicacion || \"N/A\"}</td>\n                            <td>${formatearFecha(p.ingreso)}</td>\n                        </tr>\n                    `).join(\"\")}\n                </tbody>\n            </table>`;\n            document.getElementById(\"tablaReporteContenedor\").innerHTML = tabla;\n        }\n        function renderizarReporteMovimientos(movimientos, tipo) {\n            const titulo = `Reporte de ${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`;\n            reporteHeader.style.display = \"flex\";\n            reporteTitulo.textContent = titulo;\n            reporteContenido.innerHTML = '<div class=\"chart-container\"><canvas id=\"reporteGrafico\"></canvas></div><div id=\"tablaReporteContenedor\"></div>';\n            if (movimientos.length === 0) {\n                reporteContenido.innerHTML = `<p>No hay ${tipo} en el rango de fechas seleccionado.</p>`;\n                return;\n            }\n            generarGrafico(movimientos, tipo);\n            const tabla = `\n            <table class=\"tabla-reporte\">\n                <thead>\n                    <tr>\n                        <th>Producto</th>\n                        <th>Cantidad</th>\n                        <th>Fecha</th>\n                        <th>Usuario</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${movimientos.map((m)=>`\n                        <tr>\n                            <td>${m.ProductoNombre}</td>\n                            <td>${m.Cantidad}</td>\n                            <td>${formatearFecha(m.Fecha, true)}</td>\n                            <td>${m.UsuarioNombre || \"N/A\"}</td>\n                        </tr>\n                    `).join(\"\")}\n                </tbody>\n            </table>`;\n            document.getElementById(\"tablaReporteContenedor\").innerHTML = tabla;\n        }\n        function renderizarReporteVencimientos(productos) {\n            reporteHeader.style.display = \"flex\";\n            reporteTitulo.textContent = \"Reporte de Productos Pr\\xf3ximos a Vencer\";\n            reporteContenido.innerHTML = '<div class=\"chart-container\"><canvas id=\"reporteGrafico\"></canvas></div><div id=\"tablaReporteContenedor\"></div>';\n            if (productos.length === 0) {\n                reporteContenido.innerHTML = \"<p>No hay productos pr\\xf3ximos a vencer.</p>\";\n                return;\n            }\n            generarGrafico(productos, \"vencimientos\");\n            const tabla = `\n            <table class=\"tabla-reporte\">\n                <thead>\n                    <tr>\n                        <th>Nombre</th>\n                        <th>Categor\\xeda</th>\n                        <th>Cantidad</th>\n                        <th>Fecha de Vencimiento</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${productos.map((p)=>`\n                        <tr>\n                            <td>${p.nombre}</td>\n                            <td>${p.categoria}</td>\n                            <td>${p.cantidad}</td>\n                            <td>${formatearFecha(p.vencimiento)}</td>\n                        </tr>\n                    `).join(\"\")}\n                </tbody>\n            </table>`;\n            document.getElementById(\"tablaReporteContenedor\").innerHTML = tabla;\n        }\n    }\n    // --- ENTRADA LOGIC --- //\n    function activarEntrada() {\n        const formEntrada = document.getElementById(\"formEntrada\");\n        const selectProducto = document.getElementById(\"nombreProductoEntrada\");\n        fetch(`${API_BASE_URL}/productos`).then((response)=>response.json()).then((productos)=>{\n            productos.forEach((producto)=>{\n                const option = document.createElement(\"option\");\n                option.value = producto.ProductoID;\n                option.textContent = producto.nombre;\n                selectProducto.appendChild(option);\n            });\n        }).catch((error)=>{\n            console.error(\"Error al cargar productos:\", error);\n            alert(\"Error al cargar la lista de productos.\");\n        });\n        formEntrada.addEventListener(\"submit\", function(event) {\n            event.preventDefault();\n            const formData = new FormData(event.target);\n            const data = Object.fromEntries(formData.entries());\n            fetch(`${API_BASE_URL}/entradas`, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(data)\n            }).then((response)=>response.json().then((body)=>({\n                        ok: response.ok,\n                        body\n                    }))).then(({ ok, body })=>{\n                if (!ok) throw new Error(body.error || \"Error en la respuesta del servidor\");\n                alert(body.message);\n                event.target.reset();\n                actualizarDashboard();\n            }).catch((error)=>{\n                console.error(\"Error:\", error);\n                alert(`Hubo un error al guardar la entrada: ${error.message}`);\n            });\n        });\n    }\n    // --- SALIDA LOGIC --- //\n    function activarSalida() {\n        const formSalida = document.getElementById(\"formSalida\");\n        const selectProducto = document.getElementById(\"nombreProductoSalida\");\n        fetch(`${API_BASE_URL}/productos`).then((response)=>response.json()).then((productos)=>{\n            productos.forEach((producto)=>{\n                const option = document.createElement(\"option\");\n                option.value = producto.ProductoID;\n                option.textContent = producto.nombre;\n                selectProducto.appendChild(option);\n            });\n        }).catch((error)=>{\n            console.error(\"Error al cargar productos:\", error);\n            alert(\"Error al cargar la lista de productos.\");\n        });\n        formSalida.addEventListener(\"submit\", function(event) {\n            event.preventDefault();\n            const formData = new FormData(event.target);\n            const data = Object.fromEntries(formData.entries());\n            fetch(`${API_BASE_URL}/salidas`, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(data)\n            }).then((response)=>response.json().then((body)=>({\n                        ok: response.ok,\n                        body\n                    }))).then(({ ok, body })=>{\n                if (!ok) throw new Error(body.error || \"Error en la respuesta del servidor\");\n                alert(body.message);\n                event.target.reset();\n                actualizarDashboard();\n            }).catch((error)=>{\n                console.error(\"Error:\", error);\n                alert(`Hubo un error al registrar la salida: ${error.message}`);\n            });\n        });\n    }\n    // --- USER LOGIC --- //\n    function activarUsuarios() {\n        const formUsuarios = document.getElementById(\"formUsuarios\");\n        const tablaUsuarios = document.getElementById(\"tablaUsuarios\");\n        async function cargarUsuarios() {\n            try {\n                const response = await fetch(`${API_BASE_URL}/usuarios`);\n                if (!response.ok) throw new Error(\"Error al cargar usuarios\");\n                const usuarios = await response.json();\n                renderizarUsuarios(usuarios);\n            } catch (error) {\n                console.error(error);\n                tablaUsuarios.innerHTML = `<tr><td colspan=\"5\">${error.message}</td></tr>`;\n            }\n        }\n        function renderizarUsuarios(usuarios) {\n            tablaUsuarios.innerHTML = \"\";\n            if (usuarios.length === 0) {\n                tablaUsuarios.innerHTML = '<tr><td colspan=\"5\">No hay usuarios registrados.</td></tr>';\n                return;\n            }\n            usuarios.forEach((usuario)=>{\n                const fila = document.createElement(\"tr\");\n                fila.dataset.id = usuario.UsuarioID;\n                fila.innerHTML = `\n                <td>${usuario.UsuarioID}</td>\n                <td>${usuario.nombre}</td>\n                <td>${usuario.email}</td>\n                <td>${usuario.Rol}</td>\n                <td>\n                    <button class=\"btn-editar\"><i class=\"fas fa-edit\"></i> Editar</button>\n                    <button class=\"btn-eliminar\"><i class=\"fas fa-trash-alt\"></i> Eliminar</button>\n                </td>\n            `;\n                tablaUsuarios.appendChild(fila);\n            });\n        }\n        async function handleUpdateUsuario(event, usuarioId) {\n            event.preventDefault();\n            const form = event.target;\n            const updatedUsuario = {\n                nombre: form.nombre.value,\n                email: form.email.value,\n                Rol: form.rol.value\n            };\n            if (form.password.value) updatedUsuario.password = form.password.value;\n            try {\n                const response = await fetch(`${API_BASE_URL}/usuarios/${usuarioId}`, {\n                    method: \"PUT\",\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify(updatedUsuario)\n                });\n                const result = await response.json();\n                if (!response.ok) throw new Error(result.error || \"Error en el servidor\");\n                alert(result.message);\n                hideModal();\n                cargarUsuarios();\n            } catch (error) {\n                console.error(\"Error al actualizar el usuario:\", error);\n                alert(`Error al actualizar el usuario: ${error.message}`);\n            }\n        }\n        async function handleEditarUsuario(usuarioId) {\n            try {\n                const [userResponse, formHtmlResponse] = await Promise.all([\n                    fetch(`${API_BASE_URL}/usuarios/${usuarioId}`),\n                    fetch(\"usuarios.html\")\n                ]);\n                if (!userResponse.ok) throw new Error(\"Error al cargar los datos del usuario.\");\n                if (!formHtmlResponse.ok) throw new Error(\"Error al cargar el formulario.\");\n                const usuario = await userResponse.json();\n                const formHtmlText = await formHtmlResponse.text();\n                const parser = new DOMParser();\n                const doc = parser.parseFromString(formHtmlText, \"text/html\");\n                const formNode = doc.querySelector(\"#formUsuarios\");\n                if (!formNode) throw new Error(\"No se pudo encontrar el formulario en usuarios.html\");\n                showModal(\"Editar Usuario\", formNode.outerHTML);\n                const form = modalBody.querySelector(\"form\");\n                form.querySelector(\"#nombre\").value = usuario.nombre;\n                form.querySelector(\"#email\").value = usuario.email;\n                form.querySelector(\"#rol\").value = usuario.Rol;\n                const passwordInput = form.querySelector(\"#password\");\n                passwordInput.placeholder = \"Dejar en blanco para no cambiar\";\n                passwordInput.required = false;\n                form.querySelector(\"button[type='submit']\").textContent = \"Actualizar Usuario\";\n                form.addEventListener(\"submit\", (e)=>handleUpdateUsuario(e, usuarioId));\n            } catch (error) {\n                console.error(\"Error en handleEditarUsuario:\", error);\n                alert(error.message);\n            }\n        }\n        async function handleEliminarUsuario(usuarioId) {\n            if (!confirm(\"\\xbfEst\\xe1s seguro de que quieres eliminar este usuario?\")) return;\n            try {\n                const response = await fetch(`${API_BASE_URL}/usuarios/${usuarioId}`, {\n                    method: \"DELETE\"\n                });\n                const result = await response.json();\n                if (!response.ok) throw new Error(result.error || \"Error en el servidor\");\n                alert(result.message);\n                cargarUsuarios();\n            } catch (error) {\n                console.error(\"Error al eliminar el usuario:\", error);\n                alert(`Error al eliminar el usuario: ${error.message}`);\n            }\n        }\n        tablaUsuarios.addEventListener(\"click\", function(event) {\n            const target = event.target.closest(\"button\");\n            if (!target) return;\n            const usuarioId = target.closest(\"tr\").dataset.id;\n            if (target.classList.contains(\"btn-editar\")) handleEditarUsuario(usuarioId);\n            if (target.classList.contains(\"btn-eliminar\")) handleEliminarUsuario(usuarioId);\n        });\n        formUsuarios.addEventListener(\"submit\", async (e)=>{\n            e.preventDefault();\n            const form = e.target;\n            const nuevoUsuario = {\n                nombre: form.nombre.value,\n                email: form.email.value,\n                password: form.password.value,\n                Rol: form.rol.value\n            };\n            try {\n                const response = await fetch(`${API_BASE_URL}/usuarios`, {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify(nuevoUsuario)\n                });\n                const result = await response.json();\n                if (!response.ok) throw new Error(result.error || \"Error al crear usuario\");\n                alert(result.message);\n                form.reset();\n                cargarUsuarios();\n            } catch (error) {\n                alert(error.message);\n            }\n        });\n        cargarUsuarios();\n    }\n    // --- INVENTORY LOGIC --- //\n    function activarInventario() {\n        const tablaProductos = document.getElementById(\"tablaProductos\");\n        function formatearFechaParaInput(fechaString) {\n            if (!fechaString) return \"\";\n            const fecha = new Date(fechaString);\n            fecha.setMinutes(fecha.getMinutes() + fecha.getTimezoneOffset());\n            return fecha.toISOString().split(\"T\")[0];\n        }\n        function renderizarProductos(productos) {\n            tablaProductos.innerHTML = \"\";\n            if (productos.length === 0) {\n                tablaProductos.innerHTML = '<tr><td colspan=\"7\">No hay productos en el inventario.</td></tr>';\n                return;\n            }\n            productos.forEach((producto)=>{\n                const fila = document.createElement(\"tr\");\n                fila.dataset.id = producto.ProductoID;\n                fila.innerHTML = `\n          <td>${producto.nombre}</td>\n          <td>${producto.categoria}</td>\n          <td>${producto.cantidad}</td>\n          <td>${producto.ubicacion || \"N/A\"}</td>\n          <td>${formatearFecha(producto.ingreso)}</td>\n          <td>${formatearFecha(producto.vencimiento)}</td>\n          <td>\n            <button class=\"btn-editar\" aria-label=\"Editar ${producto.nombre}\"><i class=\"fas fa-edit\"></i> Editar</button>\n            <button class=\"btn-eliminar\" aria-label=\"Eliminar ${producto.nombre}\"><i class=\"fas fa-trash-alt\"></i> Eliminar</button>\n          </td>\n        `;\n                tablaProductos.appendChild(fila);\n            });\n        }\n        async function cargarProductos() {\n            try {\n                const response = await fetch(`${API_BASE_URL}/productos`);\n                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\n                const productos = await response.json();\n                renderizarProductos(productos);\n            } catch (error) {\n                console.error(\"Error al cargar los productos:\", error);\n                tablaProductos.innerHTML = '<tr><td colspan=\"7\">Error al cargar los productos.</td></tr>';\n            }\n        }\n        async function handleAgregarProducto(event) {\n            event.preventDefault();\n            const form = event.target;\n            const formData = new FormData(form);\n            const nuevoProducto = Object.fromEntries(formData.entries());\n            try {\n                const response = await fetch(`${API_BASE_URL}/productos`, {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify(nuevoProducto)\n                });\n                const result = await response.json();\n                if (!response.ok) throw new Error(result.error || \"Error en el servidor\");\n                alert(result.message);\n                hideModal();\n                cargarProductos();\n                actualizarDashboard();\n            } catch (error) {\n                console.error(\"Error al agregar el producto:\", error);\n                alert(`Error al agregar el producto: ${error.message}`);\n            }\n        }\n        async function handleUpdateProducto(event, productoId) {\n            event.preventDefault();\n            const form = event.target;\n            const formData = new FormData(form);\n            const updatedProducto = Object.fromEntries(formData.entries());\n            try {\n                const response = await fetch(`${API_BASE_URL}/productos/${productoId}`, {\n                    method: \"PUT\",\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify(updatedProducto)\n                });\n                const result = await response.json();\n                if (!response.ok) throw new Error(result.error || \"Error en el servidor\");\n                alert(result.message);\n                hideModal();\n                cargarProductos();\n                actualizarDashboard();\n            } catch (error) {\n                console.error(\"Error al actualizar el producto:\", error);\n                alert(`Error al actualizar el producto: ${error.message}`);\n            }\n        }\n        async function handleEditarProducto(productoId) {\n            try {\n                const [productResponse, formResponse] = await Promise.all([\n                    fetch(`${API_BASE_URL}/productos/${productoId}`),\n                    fetch(\"agregar-producto.html\")\n                ]);\n                if (!productResponse.ok) throw new Error(\"Error al cargar los datos del producto.\");\n                if (!formResponse.ok) throw new Error(\"Error al cargar el formulario.\");\n                const producto = await productResponse.json();\n                const formHtml = await formResponse.text();\n                showModal(\"Editar Producto\", formHtml);\n                const form = modalBody.querySelector(\"form\");\n                form.querySelector(\"#nombre\").value = producto.nombre;\n                form.querySelector(\"#categoria\").value = producto.categoria;\n                form.querySelector(\"#cantidad\").value = producto.cantidad;\n                form.querySelector(\"#ubicacion\").value = producto.ubicacion;\n                form.querySelector(\"#ingreso\").value = formatearFechaParaInput(producto.ingreso);\n                form.querySelector(\"#vencimiento\").value = formatearFechaParaInput(producto.vencimiento);\n                form.querySelector(\"button[type='submit']\").textContent = \"Actualizar Producto\";\n                form.addEventListener(\"submit\", (e)=>handleUpdateProducto(e, productoId));\n            } catch (error) {\n                console.error(\"Error en handleEditarProducto:\", error);\n                alert(error.message);\n            }\n        }\n        async function handleEliminarProducto(productoId) {\n            if (!confirm(\"\\xbfEst\\xe1s seguro de que quieres eliminar este producto?\")) return;\n            try {\n                const response = await fetch(`${API_BASE_URL}/productos/${productoId}`, {\n                    method: \"DELETE\"\n                });\n                const result = await response.json();\n                if (!response.ok) throw new Error(result.error || \"Error en el servidor\");\n                alert(result.message);\n                cargarProductos();\n                actualizarDashboard();\n            } catch (error) {\n                console.error(\"Error al eliminar el producto:\", error);\n                alert(`Error al eliminar el producto: ${error.message}`);\n            }\n        }\n        document.getElementById(\"btnAgregar\").addEventListener(\"click\", async ()=>{\n            try {\n                const response = await fetch(\"agregar-producto.html\");\n                const formHtml = await response.text();\n                showModal(\"Agregar Producto\", formHtml);\n                modalBody.querySelector(\"form\").addEventListener(\"submit\", handleAgregarProducto);\n            } catch (error) {\n                console.error(\"Error al cargar el formulario:\", error);\n                alert(\"Error al cargar el formulario de agregar producto.\");\n            }\n        });\n        tablaProductos.addEventListener(\"click\", function(event) {\n            const target = event.target.closest(\"button\");\n            if (!target) return;\n            const productoId = target.closest(\"tr\").dataset.id;\n            if (target.classList.contains(\"btn-editar\")) handleEditarProducto(productoId);\n            if (target.classList.contains(\"btn-eliminar\")) handleEliminarProducto(productoId);\n        });\n        const searchInput = document.querySelector(\".search-bar\");\n        searchInput.addEventListener(\"input\", (e)=>{\n            const searchTerm = e.target.value.toLowerCase();\n            const filas = tablaProductos.querySelectorAll(\"tr\");\n            filas.forEach((fila)=>{\n                const nombreProducto = fila.querySelector(\"td\").textContent.toLowerCase();\n                if (nombreProducto.includes(searchTerm)) fila.style.display = \"\";\n                else fila.style.display = \"none\";\n            });\n        });\n        cargarProductos();\n        actualizarDashboard();\n    }\n    // --- NAVIGATION --- //\n    document.querySelector(\"aside.sidebar nav ul\").addEventListener(\"click\", (e)=>{\n        const link = e.target.closest(\"a\");\n        if (link) {\n            e.preventDefault();\n            const section = link.dataset.section;\n            document.querySelectorAll(\"aside.sidebar nav ul li\").forEach((li)=>li.classList.remove(\"active\"));\n            link.parentElement.classList.add(\"active\");\n            const urls = {\n                inventario: \"inventario.html\",\n                entrada: \"entrada.html\",\n                salida: \"salida.html\",\n                reportes: \"reportes.html\",\n                usuarios: \"usuarios.html\",\n                configuracion: \"configuracion.html\"\n            };\n            const url = urls[section] || \"inventario.html\";\n            loadContent(url, section);\n        }\n    });\n    // --- INITIAL LOAD --- //\n    loadContent(\"inventario.html\", \"inventario\");\n});\n\n//# sourceMappingURL=web-application-app.e3aaaa9b.js.map\n","document.addEventListener(\"DOMContentLoaded\", () => {\r\n  const API_BASE_URL = \"http://localhost:3000/api\";\r\n\r\n  const modal = document.getElementById(\"modal\");\r\n  const modalTitle = document.getElementById(\"modalTitle\");\r\n  const modalBody = document.getElementById(\"modalBody\");\r\n  const modalClose = document.getElementById(\"modalClose\");\r\n  const modalContent = document.querySelector(\".modal-content\");\r\n  const contentArea = document.getElementById(\"content-area\");\r\n  const themeToggle = document.getElementById(\"themeToggle\");\r\n\r\n  // --- THEME --- //\r\n  const savedTheme = localStorage.getItem(\"theme\");\r\n  if (savedTheme === \"dark\") {\r\n    document.body.classList.add(\"dark\");\r\n  }\r\n  themeToggle.addEventListener(\"click\", () => {\r\n    document.body.classList.toggle(\"dark\");\r\n    const isDark = document.body.classList.contains(\"dark\");\r\n    localStorage.setItem(\"theme\", isDark ? \"dark\" : \"light\");\r\n  });\r\n\r\n  // --- MODAL --- //\r\n  function showModal(title, bodyHtml) {\r\n    modalTitle.textContent = title;\r\n    modalBody.innerHTML = bodyHtml;\r\n    modal.classList.remove(\"hidden\");\r\n    modalContent.classList.add(\"start-animation\");\r\n  }\r\n  function hideModal() {\r\n    modalContent.classList.remove(\"start-animation\");\r\n    modal.classList.add(\"hidden\");\r\n  }\r\n  modalClose.addEventListener(\"click\", hideModal);\r\n  window.addEventListener(\"click\", (e) => {\r\n    if (e.target === modal) hideModal();\r\n  });\r\n\r\n  // --- GLOBAL HELPERS --- //\r\n  function formatearFecha(fechaString, includeTime = false) {\r\n    if (!fechaString) return \"N/A\";\r\n    const fecha = new Date(fechaString);\r\n    const userTimezoneOffset = fecha.getTimezoneOffset() * 60000;\r\n    const adjustedDate = new Date(fecha.getTime() + userTimezoneOffset);\r\n\r\n    const options = {\r\n      day: \"2-digit\",\r\n      month: \"2-digit\",\r\n      year: \"numeric\",\r\n    };\r\n\r\n    if (includeTime) {\r\n      options.hour = \"2-digit\";\r\n      options.minute = \"2-digit\";\r\n    }\r\n\r\n    return adjustedDate.toLocaleString(\"es-ES\", options);\r\n  }\r\n\r\n  async function actualizarDashboard() {\r\n    try {\r\n      const [productosRes, movimientosRes] = await Promise.all([\r\n        fetch(`${API_BASE_URL}/productos`),\r\n        fetch(`${API_BASE_URL}/movimientos`),\r\n      ]);\r\n\r\n      if (!productosRes.ok || !movimientosRes.ok) {\r\n        throw new Error(\"Error al cargar datos del dashboard\");\r\n      }\r\n\r\n      const productos = await productosRes.json();\r\n      const movimientos = await movimientosRes.json();\r\n\r\n      // Update dashboard cards\r\n      const STOCK_CRITICO_UMBRAL = 10;\r\n      const DIAS_PARA_VENCER_UMBRAL = 30;\r\n      const hoy = new Date();\r\n\r\n      const stockCritico = productos.filter(\r\n        (p) => p.cantidad < STOCK_CRITICO_UMBRAL\r\n      ).length;\r\n      const proximosAVencer = productos.filter((p) => {\r\n        if (!p.vencimiento) return false;\r\n        const fechaVencimiento = new Date(p.vencimiento);\r\n        const diffTiempo = fechaVencimiento.getTime() - hoy.getTime();\r\n        const diffDias = Math.ceil(diffTiempo / (1000 * 60 * 60 * 24));\r\n        return diffDias > 0 && diffDias <= DIAS_PARA_VENCER_UMBRAL;\r\n      }).length;\r\n\r\n      document.getElementById(\"totalProductos\").textContent = productos.length;\r\n      document.getElementById(\"stockCritico\").textContent = stockCritico;\r\n      document.getElementById(\"proximosAVencer\").textContent = proximosAVencer;\r\n\r\n      // Update movimientos\r\n      const contenedor = document.getElementById(\"ultimosMovimientos\");\r\n      if (!movimientos || movimientos.length === 0) {\r\n        contenedor.innerHTML = \"<p>No hay movimientos recientes.</p>\";\r\n        return;\r\n      }\r\n\r\n      const lista = document.createElement(\"ul\");\r\n      lista.className = \"movimientos-lista\";\r\n\r\n      movimientos.forEach((mov) => {\r\n        const item = document.createElement(\"li\");\r\n        const tipoClase = mov.Tipo === \"Entrada\" ? \"entrada\" : \"salida\";\r\n        item.innerHTML = `\r\n              <span class=\"movimiento-tipo ${tipoClase}\">${mov.Tipo}</span>\r\n              <span class=\"movimiento-cantidad\">${mov.Cantidad} x</span>\r\n              <span class=\"movimiento-nombre\">${mov.ProductoNombre}</span>\r\n              <span class=\"movimiento-fecha\">${formatearFecha(\r\n                mov.Fecha,\r\n                true\r\n              )}</span>\r\n          `;\r\n        lista.appendChild(item);\r\n      });\r\n      contenedor.innerHTML = \"\";\r\n      contenedor.appendChild(lista);\r\n    } catch (error) {\r\n      console.error(\"Error actualizando dashboard:\", error);\r\n    }\r\n  }\r\n\r\n  // --- DYNAMIC CONTENT LOADING --- //\r\n  function loadScript(src) {\r\n    return new Promise((resolve, reject) => {\r\n      const script = document.createElement(\"script\");\r\n      script.src = src;\r\n      script.onload = resolve;\r\n      script.onerror = reject;\r\n      document.head.appendChild(script);\r\n    });\r\n  }\r\n\r\n  function loadContent(url, section) {\r\n    fetch(url)\r\n      .then((response) => response.text())\r\n      .then((data) => {\r\n        contentArea.innerHTML = data;\r\n        document.getElementById(\"header-title\").textContent =\r\n          section.charAt(0).toUpperCase() + section.slice(1);\r\n\r\n        switch (section) {\r\n          case \"inventario\":\r\n            activarInventario();\r\n            break;\r\n          case \"usuarios\":\r\n            activarUsuarios();\r\n            break;\r\n          case \"entrada\":\r\n            activarEntrada();\r\n            break;\r\n          case \"salida\":\r\n            activarSalida();\r\n            break;\r\n          case \"reportes\":\r\n            loadScript(\"https://cdn.jsdelivr.net/npm/chart.js\")\r\n              .then(() => {\r\n                activarReportes();\r\n              })\r\n              .catch((error) => {\r\n                console.error(\"Error loading Chart.js\", error);\r\n                contentArea.innerHTML =\r\n                  \"<p>Error al cargar la librera de grficos.</p>\";\r\n              });\r\n            break;\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error al cargar la seccin:\", error);\r\n        contentArea.innerHTML = \"<p>Error al cargar la seccin.</p>\";\r\n      });\r\n  }\r\n\r\n  // --- REPORTES LOGIC --- //\r\n  function activarReportes() {\r\n    const formReportes = document.getElementById(\"formReportes\");\r\n    const reporteContainer = document.getElementById(\"reporteContainer\");\r\n    const reporteHeader = document.getElementById(\"reporteHeader\");\r\n    const reporteTitulo = document.getElementById(\"reporteTitulo\");\r\n    const btnImprimir = document.getElementById(\"btnImprimir\");\r\n    const reporteContenido = document.getElementById(\"reporteContenido\");\r\n    const fechaInicioInput = document.getElementById(\"fechaInicioReporte\");\r\n    const fechaFinInput = document.getElementById(\"fechaFinReporte\");\r\n    const tipoReporteSelect = document.getElementById(\"tipoReporte\");\r\n\r\n    // Show/hide date fields based on report type\r\n    tipoReporteSelect.addEventListener(\"change\", () => {\r\n      const selected = tipoReporteSelect.value;\r\n      if (selected === \"entradas\" || selected === \"salidas\") {\r\n        fechaInicioInput.parentElement.style.display = \"block\";\r\n        fechaFinInput.parentElement.style.display = \"block\";\r\n      } else {\r\n        fechaInicioInput.parentElement.style.display = \"none\";\r\n        fechaFinInput.parentElement.style.display = \"none\";\r\n      }\r\n    });\r\n    // Trigger change on load\r\n    tipoReporteSelect.dispatchEvent(new Event(\"change\"));\r\n\r\n    btnImprimir.addEventListener(\"click\", () => {\r\n      window.print();\r\n    });\r\n\r\n    formReportes.addEventListener(\"submit\", async function (event) {\r\n      event.preventDefault();\r\n      const tipoReporte = tipoReporteSelect.value;\r\n      const fechaInicio = fechaInicioInput.value;\r\n      const fechaFin = fechaFinInput.value;\r\n\r\n      reporteContenido.innerHTML = \"<p>Generando reporte...</p>\";\r\n      reporteHeader.style.display = \"none\";\r\n\r\n      try {\r\n        let url;\r\n        let data;\r\n\r\n        switch (tipoReporte) {\r\n          case \"inventario\":\r\n            url = `${API_BASE_URL}/productos`;\r\n            const response = await fetch(url);\r\n            if (!response.ok) throw new Error(\"Error al cargar el inventario.\");\r\n            data = await response.json();\r\n            renderizarReporteInventario(data);\r\n            break;\r\n          case \"entradas\":\r\n          case \"salidas\":\r\n            url = `${API_BASE_URL}/movimientos?tipo=${tipoReporte.slice(\r\n              0,\r\n              -1\r\n            )}&inicio=${fechaInicio}&fin=${fechaFin}`;\r\n            const movResponse = await fetch(url);\r\n            if (!movResponse.ok)\r\n              throw new Error(`Error al cargar ${tipoReporte}.`);\r\n            data = await movResponse.json();\r\n            renderizarReporteMovimientos(data, tipoReporte);\r\n            break;\r\n          case \"vencimientos\":\r\n            url = `${API_BASE_URL}/productos/vencimiento`;\r\n            const vencResponse = await fetch(url);\r\n            if (!vencResponse.ok)\r\n              throw new Error(\"Error al cargar productos por vencer.\");\r\n            data = await vencResponse.json();\r\n            renderizarReporteVencimientos(data);\r\n            break;\r\n        }\r\n      } catch (error) {\r\n        reporteContenido.innerHTML = `<p class=\"error\">Error: ${error.message}</p>`;\r\n        console.error(\"Error al generar reporte:\", error);\r\n      }\r\n    });\r\n\r\n    function generarGrafico(data, tipoReporte) {\r\n      const ctx = document.getElementById(\"reporteGrafico\").getContext(\"2d\");\r\n      let chartData = {};\r\n\r\n      // Destroy previous chart instance if it exists\r\n      if (window.myChart instanceof Chart) {\r\n        window.myChart.destroy();\r\n      }\r\n\r\n      switch (tipoReporte) {\r\n        case \"inventario\":\r\n          chartData = {\r\n            labels: data.map((p) => p.nombre),\r\n            datasets: [\r\n              {\r\n                label: \"Cantidad en Inventario\",\r\n                data: data.map((p) => p.cantidad),\r\n                backgroundColor: \"rgba(54, 162, 235, 0.6)\",\r\n                borderColor: \"rgba(54, 162, 235, 1)\",\r\n                borderWidth: 1,\r\n              },\r\n            ],\r\n          };\r\n          break;\r\n        case \"entradas\":\r\n        case \"salidas\":\r\n          const dataAgrupada = data.reduce((acc, m) => {\r\n            const fecha = formatearFecha(m.Fecha);\r\n            acc[fecha] = (acc[fecha] || 0) + m.Cantidad;\r\n            return acc;\r\n          }, {});\r\n\r\n          chartData = {\r\n            labels: Object.keys(dataAgrupada),\r\n            datasets: [\r\n              {\r\n                label: `Cantidad de ${tipoReporte}`,\r\n                data: Object.values(dataAgrupada),\r\n                backgroundColor:\r\n                  tipoReporte === \"entradas\"\r\n                    ? \"rgba(75, 192, 192, 0.6)\"\r\n                    : \"rgba(255, 99, 132, 0.6)\",\r\n                borderColor:\r\n                  tipoReporte === \"entradas\"\r\n                    ? \"rgba(75, 192, 192, 1)\"\r\n                    : \"rgba(255, 99, 132, 1)\",\r\n                borderWidth: 1,\r\n              },\r\n            ],\r\n          };\r\n          break;\r\n        case \"vencimientos\":\r\n          chartData = {\r\n            labels: data.map((p) => p.nombre),\r\n            datasets: [\r\n              {\r\n                label: \"Das para Vencer\",\r\n                data: data.map((p) => {\r\n                  const hoy = new Date();\r\n                  const fechaVencimiento = new Date(p.vencimiento);\r\n                  const diffTiempo = fechaVencimiento.getTime() - hoy.getTime();\r\n                  return Math.ceil(diffTiempo / (1000 * 60 * 60 * 24));\r\n                }),\r\n                backgroundColor: \"rgba(255, 159, 64, 0.6)\",\r\n                borderColor: \"rgba(255, 159, 64, 1)\",\r\n                borderWidth: 1,\r\n              },\r\n            ],\r\n          };\r\n          break;\r\n      }\r\n\r\n      window.myChart = new Chart(ctx, {\r\n        type: \"bar\",\r\n        data: chartData,\r\n        options: {\r\n          scales: {\r\n            y: {\r\n              beginAtZero: true,\r\n            },\r\n          },\r\n          responsive: true,\r\n          maintainAspectRatio: false,\r\n        },\r\n      });\r\n    }\r\n\r\n    function renderizarReporteInventario(productos) {\r\n      reporteHeader.style.display = \"flex\";\r\n      reporteTitulo.textContent = \"Reporte de Inventario Actual\";\r\n      reporteContenido.innerHTML =\r\n        '<div class=\"chart-container\"><canvas id=\"reporteGrafico\"></canvas></div><div id=\"tablaReporteContenedor\"></div>';\r\n\r\n      if (productos.length === 0) {\r\n        reporteContenido.innerHTML =\r\n          \"<p>No hay productos en el inventario.</p>\";\r\n        return;\r\n      }\r\n      generarGrafico(productos, \"inventario\");\r\n      const tabla = `\r\n            <table class=\"tabla-reporte\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Nombre</th>\r\n                        <th>Categora</th>\r\n                        <th>Cantidad</th>\r\n                        <th>Ubicacin</th>\r\n                        <th>Fecha Ingreso</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    ${productos\r\n                      .map(\r\n                        (p) => `\r\n                        <tr>\r\n                            <td>${p.nombre}</td>\r\n                            <td>${p.categoria}</td>\r\n                            <td>${p.cantidad}</td>\r\n                            <td>${p.ubicacion || \"N/A\"}</td>\r\n                            <td>${formatearFecha(p.ingreso)}</td>\r\n                        </tr>\r\n                    `\r\n                      )\r\n                      .join(\"\")}\r\n                </tbody>\r\n            </table>`;\r\n      document.getElementById(\"tablaReporteContenedor\").innerHTML = tabla;\r\n    }\r\n\r\n    function renderizarReporteMovimientos(movimientos, tipo) {\r\n      const titulo = `Reporte de ${\r\n        tipo.charAt(0).toUpperCase() + tipo.slice(1)\r\n      }`;\r\n      reporteHeader.style.display = \"flex\";\r\n      reporteTitulo.textContent = titulo;\r\n      reporteContenido.innerHTML =\r\n        '<div class=\"chart-container\"><canvas id=\"reporteGrafico\"></canvas></div><div id=\"tablaReporteContenedor\"></div>';\r\n\r\n      if (movimientos.length === 0) {\r\n        reporteContenido.innerHTML = `<p>No hay ${tipo} en el rango de fechas seleccionado.</p>`;\r\n        return;\r\n      }\r\n      generarGrafico(movimientos, tipo);\r\n      const tabla = `\r\n            <table class=\"tabla-reporte\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Producto</th>\r\n                        <th>Cantidad</th>\r\n                        <th>Fecha</th>\r\n                        <th>Usuario</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    ${movimientos\r\n                      .map(\r\n                        (m) => `\r\n                        <tr>\r\n                            <td>${m.ProductoNombre}</td>\r\n                            <td>${m.Cantidad}</td>\r\n                            <td>${formatearFecha(m.Fecha, true)}</td>\r\n                            <td>${m.UsuarioNombre || \"N/A\"}</td>\r\n                        </tr>\r\n                    `\r\n                      )\r\n                      .join(\"\")}\r\n                </tbody>\r\n            </table>`;\r\n      document.getElementById(\"tablaReporteContenedor\").innerHTML = tabla;\r\n    }\r\n\r\n    function renderizarReporteVencimientos(productos) {\r\n      reporteHeader.style.display = \"flex\";\r\n      reporteTitulo.textContent = \"Reporte de Productos Prximos a Vencer\";\r\n      reporteContenido.innerHTML =\r\n        '<div class=\"chart-container\"><canvas id=\"reporteGrafico\"></canvas></div><div id=\"tablaReporteContenedor\"></div>';\r\n\r\n      if (productos.length === 0) {\r\n        reporteContenido.innerHTML =\r\n          \"<p>No hay productos prximos a vencer.</p>\";\r\n        return;\r\n      }\r\n      generarGrafico(productos, \"vencimientos\");\r\n      const tabla = `\r\n            <table class=\"tabla-reporte\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Nombre</th>\r\n                        <th>Categora</th>\r\n                        <th>Cantidad</th>\r\n                        <th>Fecha de Vencimiento</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    ${productos\r\n                      .map(\r\n                        (p) => `\r\n                        <tr>\r\n                            <td>${p.nombre}</td>\r\n                            <td>${p.categoria}</td>\r\n                            <td>${p.cantidad}</td>\r\n                            <td>${formatearFecha(p.vencimiento)}</td>\r\n                        </tr>\r\n                    `\r\n                      )\r\n                      .join(\"\")}\r\n                </tbody>\r\n            </table>`;\r\n      document.getElementById(\"tablaReporteContenedor\").innerHTML = tabla;\r\n    }\r\n  }\r\n\r\n  // --- ENTRADA LOGIC --- //\r\n  function activarEntrada() {\r\n    const formEntrada = document.getElementById(\"formEntrada\");\r\n    const selectProducto = document.getElementById(\"nombreProductoEntrada\");\r\n\r\n    fetch(`${API_BASE_URL}/productos`)\r\n      .then((response) => response.json())\r\n      .then((productos) => {\r\n        productos.forEach((producto) => {\r\n          const option = document.createElement(\"option\");\r\n          option.value = producto.ProductoID;\r\n          option.textContent = producto.nombre;\r\n          selectProducto.appendChild(option);\r\n        });\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error al cargar productos:\", error);\r\n        alert(\"Error al cargar la lista de productos.\");\r\n      });\r\n\r\n    formEntrada.addEventListener(\"submit\", function (event) {\r\n      event.preventDefault();\r\n      const formData = new FormData(event.target);\r\n      const data = Object.fromEntries(formData.entries());\r\n\r\n      fetch(`${API_BASE_URL}/entradas`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(data),\r\n      })\r\n        .then((response) =>\r\n          response.json().then((body) => ({ ok: response.ok, body }))\r\n        )\r\n        .then(({ ok, body }) => {\r\n          if (!ok) {\r\n            throw new Error(body.error || \"Error en la respuesta del servidor\");\r\n          }\r\n          alert(body.message);\r\n          event.target.reset();\r\n          actualizarDashboard();\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error:\", error);\r\n          alert(`Hubo un error al guardar la entrada: ${error.message}`);\r\n        });\r\n    });\r\n  }\r\n\r\n  // --- SALIDA LOGIC --- //\r\n  function activarSalida() {\r\n    const formSalida = document.getElementById(\"formSalida\");\r\n    const selectProducto = document.getElementById(\"nombreProductoSalida\");\r\n\r\n    fetch(`${API_BASE_URL}/productos`)\r\n      .then((response) => response.json())\r\n      .then((productos) => {\r\n        productos.forEach((producto) => {\r\n          const option = document.createElement(\"option\");\r\n          option.value = producto.ProductoID;\r\n          option.textContent = producto.nombre;\r\n          selectProducto.appendChild(option);\r\n        });\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error al cargar productos:\", error);\r\n        alert(\"Error al cargar la lista de productos.\");\r\n      });\r\n\r\n    formSalida.addEventListener(\"submit\", function (event) {\r\n      event.preventDefault();\r\n      const formData = new FormData(event.target);\r\n      const data = Object.fromEntries(formData.entries());\r\n\r\n      fetch(`${API_BASE_URL}/salidas`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(data),\r\n      })\r\n        .then((response) =>\r\n          response.json().then((body) => ({ ok: response.ok, body }))\r\n        )\r\n        .then(({ ok, body }) => {\r\n          if (!ok) {\r\n            throw new Error(body.error || \"Error en la respuesta del servidor\");\r\n          }\r\n          alert(body.message);\r\n          event.target.reset();\r\n          actualizarDashboard();\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error:\", error);\r\n          alert(`Hubo un error al registrar la salida: ${error.message}`);\r\n        });\r\n    });\r\n  }\r\n\r\n  // --- USER LOGIC --- //\r\n  function activarUsuarios() {\r\n    const formUsuarios = document.getElementById(\"formUsuarios\");\r\n    const tablaUsuarios = document.getElementById(\"tablaUsuarios\");\r\n\r\n    async function cargarUsuarios() {\r\n      try {\r\n        const response = await fetch(`${API_BASE_URL}/usuarios`);\r\n        if (!response.ok) throw new Error(\"Error al cargar usuarios\");\r\n        const usuarios = await response.json();\r\n        renderizarUsuarios(usuarios);\r\n      } catch (error) {\r\n        console.error(error);\r\n        tablaUsuarios.innerHTML = `<tr><td colspan=\"5\">${error.message}</td></tr>`;\r\n      }\r\n    }\r\n\r\n    function renderizarUsuarios(usuarios) {\r\n      tablaUsuarios.innerHTML = \"\";\r\n      if (usuarios.length === 0) {\r\n        tablaUsuarios.innerHTML =\r\n          '<tr><td colspan=\"5\">No hay usuarios registrados.</td></tr>';\r\n        return;\r\n      }\r\n      usuarios.forEach((usuario) => {\r\n        const fila = document.createElement(\"tr\");\r\n        fila.dataset.id = usuario.UsuarioID;\r\n        fila.innerHTML = `\r\n                <td>${usuario.UsuarioID}</td>\r\n                <td>${usuario.nombre}</td>\r\n                <td>${usuario.email}</td>\r\n                <td>${usuario.Rol}</td>\r\n                <td>\r\n                    <button class=\"btn-editar\"><i class=\"fas fa-edit\"></i> Editar</button>\r\n                    <button class=\"btn-eliminar\"><i class=\"fas fa-trash-alt\"></i> Eliminar</button>\r\n                </td>\r\n            `;\r\n        tablaUsuarios.appendChild(fila);\r\n      });\r\n    }\r\n\r\n    async function handleUpdateUsuario(event, usuarioId) {\r\n      event.preventDefault();\r\n      const form = event.target;\r\n      const updatedUsuario = {\r\n        nombre: form.nombre.value,\r\n        email: form.email.value,\r\n        Rol: form.rol.value,\r\n      };\r\n\r\n      if (form.password.value) {\r\n        updatedUsuario.password = form.password.value;\r\n      }\r\n\r\n      try {\r\n        const response = await fetch(`${API_BASE_URL}/usuarios/${usuarioId}`, {\r\n          method: \"PUT\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(updatedUsuario),\r\n        });\r\n        const result = await response.json();\r\n        if (!response.ok)\r\n          throw new Error(result.error || \"Error en el servidor\");\r\n        alert(result.message);\r\n        hideModal();\r\n        cargarUsuarios();\r\n      } catch (error) {\r\n        console.error(\"Error al actualizar el usuario:\", error);\r\n        alert(`Error al actualizar el usuario: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    async function handleEditarUsuario(usuarioId) {\r\n      try {\r\n        const [userResponse, formHtmlResponse] = await Promise.all([\r\n          fetch(`${API_BASE_URL}/usuarios/${usuarioId}`),\r\n          fetch(\"usuarios.html\"), // No necesita autenticacin\r\n        ]);\r\n\r\n        if (!userResponse.ok)\r\n          throw new Error(\"Error al cargar los datos del usuario.\");\r\n        if (!formHtmlResponse.ok)\r\n          throw new Error(\"Error al cargar el formulario.\");\r\n\r\n        const usuario = await userResponse.json();\r\n        const formHtmlText = await formHtmlResponse.text();\r\n\r\n        const parser = new DOMParser();\r\n        const doc = parser.parseFromString(formHtmlText, \"text/html\");\r\n        const formNode = doc.querySelector(\"#formUsuarios\");\r\n\r\n        if (!formNode)\r\n          throw new Error(\r\n            \"No se pudo encontrar el formulario en usuarios.html\"\r\n          );\r\n\r\n        showModal(\"Editar Usuario\", formNode.outerHTML);\r\n\r\n        const form = modalBody.querySelector(\"form\");\r\n        form.querySelector(\"#nombre\").value = usuario.nombre;\r\n        form.querySelector(\"#email\").value = usuario.email;\r\n        form.querySelector(\"#rol\").value = usuario.Rol;\r\n\r\n        const passwordInput = form.querySelector(\"#password\");\r\n        passwordInput.placeholder = \"Dejar en blanco para no cambiar\";\r\n        passwordInput.required = false;\r\n\r\n        form.querySelector(\"button[type='submit']\").textContent =\r\n          \"Actualizar Usuario\";\r\n\r\n        form.addEventListener(\"submit\", (e) =>\r\n          handleUpdateUsuario(e, usuarioId)\r\n        );\r\n      } catch (error) {\r\n        console.error(\"Error en handleEditarUsuario:\", error);\r\n        alert(error.message);\r\n      }\r\n    }\r\n\r\n    async function handleEliminarUsuario(usuarioId) {\r\n      if (!confirm(\"Ests seguro de que quieres eliminar este usuario?\"))\r\n        return;\r\n\r\n      try {\r\n        const response = await fetch(`${API_BASE_URL}/usuarios/${usuarioId}`, {\r\n          method: \"DELETE\",\r\n        });\r\n        const result = await response.json();\r\n        if (!response.ok)\r\n          throw new Error(result.error || \"Error en el servidor\");\r\n        alert(result.message);\r\n        cargarUsuarios();\r\n      } catch (error) {\r\n        console.error(\"Error al eliminar el usuario:\", error);\r\n        alert(`Error al eliminar el usuario: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    tablaUsuarios.addEventListener(\"click\", function (event) {\r\n      const target = event.target.closest(\"button\");\r\n      if (!target) return;\r\n\r\n      const usuarioId = target.closest(\"tr\").dataset.id;\r\n\r\n      if (target.classList.contains(\"btn-editar\")) {\r\n        handleEditarUsuario(usuarioId);\r\n      }\r\n\r\n      if (target.classList.contains(\"btn-eliminar\")) {\r\n        handleEliminarUsuario(usuarioId);\r\n      }\r\n    });\r\n\r\n    formUsuarios.addEventListener(\"submit\", async (e) => {\r\n      e.preventDefault();\r\n      const form = e.target;\r\n      const nuevoUsuario = {\r\n        nombre: form.nombre.value,\r\n        email: form.email.value,\r\n        password: form.password.value,\r\n        Rol: form.rol.value,\r\n      };\r\n\r\n      try {\r\n        const response = await fetch(`${API_BASE_URL}/usuarios`, {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(nuevoUsuario),\r\n        });\r\n        const result = await response.json();\r\n        if (!response.ok)\r\n          throw new Error(result.error || \"Error al crear usuario\");\r\n        alert(result.message);\r\n        form.reset();\r\n        cargarUsuarios();\r\n      } catch (error) {\r\n        alert(error.message);\r\n      }\r\n    });\r\n\r\n    cargarUsuarios();\r\n  }\r\n\r\n  // --- INVENTORY LOGIC --- //\r\n  function activarInventario() {\r\n    const tablaProductos = document.getElementById(\"tablaProductos\");\r\n\r\n    function formatearFechaParaInput(fechaString) {\r\n      if (!fechaString) return \"\";\r\n      const fecha = new Date(fechaString);\r\n      fecha.setMinutes(fecha.getMinutes() + fecha.getTimezoneOffset());\r\n      return fecha.toISOString().split(\"T\")[0];\r\n    }\r\n\r\n    function renderizarProductos(productos) {\r\n      tablaProductos.innerHTML = \"\";\r\n      if (productos.length === 0) {\r\n        tablaProductos.innerHTML =\r\n          '<tr><td colspan=\"7\">No hay productos en el inventario.</td></tr>';\r\n        return;\r\n      }\r\n      productos.forEach((producto) => {\r\n        const fila = document.createElement(\"tr\");\r\n        fila.dataset.id = producto.ProductoID;\r\n        fila.innerHTML = `\r\n          <td>${producto.nombre}</td>\r\n          <td>${producto.categoria}</td>\r\n          <td>${producto.cantidad}</td>\r\n          <td>${producto.ubicacion || \"N/A\"}</td>\r\n          <td>${formatearFecha(producto.ingreso)}</td>\r\n          <td>${formatearFecha(producto.vencimiento)}</td>\r\n          <td>\r\n            <button class=\"btn-editar\" aria-label=\"Editar ${\r\n              producto.nombre\r\n            }\"><i class=\"fas fa-edit\"></i> Editar</button>\r\n            <button class=\"btn-eliminar\" aria-label=\"Eliminar ${\r\n              producto.nombre\r\n            }\"><i class=\"fas fa-trash-alt\"></i> Eliminar</button>\r\n          </td>\r\n        `;\r\n        tablaProductos.appendChild(fila);\r\n      });\r\n    }\r\n\r\n    async function cargarProductos() {\r\n      try {\r\n        const response = await fetch(`${API_BASE_URL}/productos`);\r\n        if (!response.ok)\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        const productos = await response.json();\r\n        renderizarProductos(productos);\r\n      } catch (error) {\r\n        console.error(\"Error al cargar los productos:\", error);\r\n        tablaProductos.innerHTML =\r\n          '<tr><td colspan=\"7\">Error al cargar los productos.</td></tr>';\r\n      }\r\n    }\r\n\r\n    async function handleAgregarProducto(event) {\r\n      event.preventDefault();\r\n      const form = event.target;\r\n      const formData = new FormData(form);\r\n      const nuevoProducto = Object.fromEntries(formData.entries());\r\n\r\n      try {\r\n        const response = await fetch(`${API_BASE_URL}/productos`, {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(nuevoProducto),\r\n        });\r\n        const result = await response.json();\r\n        if (!response.ok)\r\n          throw new Error(result.error || \"Error en el servidor\");\r\n        alert(result.message);\r\n        hideModal();\r\n        cargarProductos();\r\n        actualizarDashboard();\r\n      } catch (error) {\r\n        console.error(\"Error al agregar el producto:\", error);\r\n        alert(`Error al agregar el producto: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    async function handleUpdateProducto(event, productoId) {\r\n      event.preventDefault();\r\n      const form = event.target;\r\n      const formData = new FormData(form);\r\n      const updatedProducto = Object.fromEntries(formData.entries());\r\n\r\n      try {\r\n        const response = await fetch(\r\n          `${API_BASE_URL}/productos/${productoId}`,\r\n          {\r\n            method: \"PUT\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify(updatedProducto),\r\n          }\r\n        );\r\n        const result = await response.json();\r\n        if (!response.ok)\r\n          throw new Error(result.error || \"Error en el servidor\");\r\n        alert(result.message);\r\n        hideModal();\r\n        cargarProductos();\r\n        actualizarDashboard();\r\n      } catch (error) {\r\n        console.error(\"Error al actualizar el producto:\", error);\r\n        alert(`Error al actualizar el producto: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    async function handleEditarProducto(productoId) {\r\n      try {\r\n        const [productResponse, formResponse] = await Promise.all([\r\n          fetch(`${API_BASE_URL}/productos/${productoId}`),\r\n          fetch(\"agregar-producto.html\"), // No necesita autenticacin\r\n        ]);\r\n\r\n        if (!productResponse.ok)\r\n          throw new Error(\"Error al cargar los datos del producto.\");\r\n        if (!formResponse.ok) throw new Error(\"Error al cargar el formulario.\");\r\n\r\n        const producto = await productResponse.json();\r\n        const formHtml = await formResponse.text();\r\n\r\n        showModal(\"Editar Producto\", formHtml);\r\n\r\n        const form = modalBody.querySelector(\"form\");\r\n        form.querySelector(\"#nombre\").value = producto.nombre;\r\n        form.querySelector(\"#categoria\").value = producto.categoria;\r\n        form.querySelector(\"#cantidad\").value = producto.cantidad;\r\n        form.querySelector(\"#ubicacion\").value = producto.ubicacion;\r\n        form.querySelector(\"#ingreso\").value = formatearFechaParaInput(\r\n          producto.ingreso\r\n        );\r\n        form.querySelector(\"#vencimiento\").value = formatearFechaParaInput(\r\n          producto.vencimiento\r\n        );\r\n        form.querySelector(\"button[type='submit']\").textContent =\r\n          \"Actualizar Producto\";\r\n\r\n        form.addEventListener(\"submit\", (e) =>\r\n          handleUpdateProducto(e, productoId)\r\n        );\r\n      } catch (error) {\r\n        console.error(\"Error en handleEditarProducto:\", error);\r\n        alert(error.message);\r\n      }\r\n    }\r\n\r\n    async function handleEliminarProducto(productoId) {\r\n      if (!confirm(\"Ests seguro de que quieres eliminar este producto?\"))\r\n        return;\r\n\r\n      try {\r\n        const response = await fetch(\r\n          `${API_BASE_URL}/productos/${productoId}`,\r\n          {\r\n            method: \"DELETE\",\r\n          }\r\n        );\r\n        const result = await response.json();\r\n        if (!response.ok)\r\n          throw new Error(result.error || \"Error en el servidor\");\r\n        alert(result.message);\r\n        cargarProductos();\r\n        actualizarDashboard();\r\n      } catch (error) {\r\n        console.error(\"Error al eliminar el producto:\", error);\r\n        alert(`Error al eliminar el producto: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    document\r\n      .getElementById(\"btnAgregar\")\r\n      .addEventListener(\"click\", async () => {\r\n        try {\r\n          const response = await fetch(\"agregar-producto.html\");\r\n          const formHtml = await response.text();\r\n          showModal(\"Agregar Producto\", formHtml);\r\n          modalBody\r\n            .querySelector(\"form\")\r\n            .addEventListener(\"submit\", handleAgregarProducto);\r\n        } catch (error) {\r\n          console.error(\"Error al cargar el formulario:\", error);\r\n          alert(\"Error al cargar el formulario de agregar producto.\");\r\n        }\r\n      });\r\n\r\n    tablaProductos.addEventListener(\"click\", function (event) {\r\n      const target = event.target.closest(\"button\");\r\n      if (!target) return;\r\n\r\n      const productoId = target.closest(\"tr\").dataset.id;\r\n\r\n      if (target.classList.contains(\"btn-editar\")) {\r\n        handleEditarProducto(productoId);\r\n      }\r\n\r\n      if (target.classList.contains(\"btn-eliminar\")) {\r\n        handleEliminarProducto(productoId);\r\n      }\r\n    });\r\n\r\n    const searchInput = document.querySelector(\".search-bar\");\r\n    searchInput.addEventListener(\"input\", (e) => {\r\n      const searchTerm = e.target.value.toLowerCase();\r\n      const filas = tablaProductos.querySelectorAll(\"tr\");\r\n      filas.forEach((fila) => {\r\n        const nombreProducto = fila\r\n          .querySelector(\"td\")\r\n          .textContent.toLowerCase();\r\n        if (nombreProducto.includes(searchTerm)) {\r\n          fila.style.display = \"\";\r\n        } else {\r\n          fila.style.display = \"none\";\r\n        }\r\n      });\r\n    });\r\n\r\n    cargarProductos();\r\n    actualizarDashboard();\r\n  }\r\n\r\n  // --- NAVIGATION --- //\r\n  document\r\n    .querySelector(\"aside.sidebar nav ul\")\r\n    .addEventListener(\"click\", (e) => {\r\n      const link = e.target.closest(\"a\");\r\n      if (link) {\r\n        e.preventDefault();\r\n        const section = link.dataset.section;\r\n\r\n        document\r\n          .querySelectorAll(\"aside.sidebar nav ul li\")\r\n          .forEach((li) => li.classList.remove(\"active\"));\r\n        link.parentElement.classList.add(\"active\");\r\n\r\n        const urls = {\r\n          inventario: \"inventario.html\",\r\n          entrada: \"entrada.html\",\r\n          salida: \"salida.html\",\r\n          reportes: \"reportes.html\",\r\n          usuarios: \"usuarios.html\",\r\n          configuracion: \"configuracion.html\",\r\n        };\r\n        const url = urls[section] || \"inventario.html\";\r\n        loadContent(url, section);\r\n      }\r\n    });\r\n\r\n  // --- INITIAL LOAD --- //\r\n  loadContent(\"inventario.html\", \"inventario\");\r\n});\r\n"],"names":["document","addEventListener","API_BASE_URL","modal","getElementById","modalTitle","modalBody","modalClose","modalContent","querySelector","contentArea","themeToggle","showModal","title","bodyHtml","textContent","innerHTML","classList","remove","add","hideModal","formatearFecha","fechaString","includeTime","fecha","Date","userTimezoneOffset","getTimezoneOffset","adjustedDate","getTime","options","day","month","year","hour","minute","toLocaleString","actualizarDashboard","productosRes","movimientosRes","Promise","all","fetch","ok","Error","productos","json","movimientos","hoy","stockCritico","filter","p","cantidad","length","proximosAVencer","vencimiento","diffTiempo","fechaVencimiento","diffDias","Math","ceil","contenedor","lista","createElement","className","forEach","mov","item","tipoClase","Tipo","Cantidad","ProductoNombre","Fecha","appendChild","error","console","loadContent","url","section","then","response","text","data","charAt","toUpperCase","slice","activarInventario","tablaProductos","formatearFechaParaInput","setMinutes","getMinutes","toISOString","split","cargarProductos","status","renderizarProductos","producto","fila","dataset","id","ProductoID","nombre","categoria","ubicacion","ingreso","handleAgregarProducto","event","preventDefault","nuevoProducto","Object","fromEntries","formData","FormData","target","entries","method","headers","body","JSON","stringify","result","alert","message","handleUpdateProducto","productoId","updatedProducto","handleEditarProducto","productResponse","formResponse","formHtml","form","value","e","handleEliminarProducto","confirm","closest","contains","searchInput","searchTerm","toLowerCase","filas","querySelectorAll","nombreProducto","includes","style","display","activarUsuarios","formUsuarios","tablaUsuarios","cargarUsuarios","usuarios","renderizarUsuarios","usuario","UsuarioID","email","Rol","handleUpdateUsuario","usuarioId","updatedUsuario","rol","password","handleEditarUsuario","userResponse","formHtmlResponse","formHtmlText","formNode","doc","parser","DOMParser","parseFromString","outerHTML","passwordInput","placeholder","required","handleEliminarUsuario","nuevoUsuario","reset","formEntrada","selectProducto","option","catch","formSalida","loadScript","resolve","reject","script","src","onload","onerror","head","activarReportes","formReportes","reporteHeader","reporteTitulo","btnImprimir","reporteContenido","fechaInicioInput","fechaFinInput","tipoReporteSelect","generarGrafico","tipoReporte","ctx","getContext","chartData","window","myChart","Chart","destroy","labels","map","datasets","label","backgroundColor","borderColor","borderWidth","dataAgrupada","reduce","acc","m","keys","values","type","scales","y","beginAtZero","responsive","maintainAspectRatio","selected","parentElement","dispatchEvent","Event","print","fechaInicio","fechaFin","renderizarReporteInventario","tabla","join","movResponse","renderizarReporteMovimientos","tipo","titulo","UsuarioNombre","vencResponse","renderizarReporteVencimientos","savedTheme","localStorage","getItem","toggle","isDark","setItem","link","li","urls","inventario","entrada","salida","reportes","configuracion"],"version":3,"file":"web-application-app.e3aaaa9b.js.map"}